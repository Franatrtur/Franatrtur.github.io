!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).Uluru={})}(this,(function(t){"use strict";class e{encode(t){let e=new Uint8Array(t.length);for(let n=0,r=t.length;n<r;n++)e[n]=t.charCodeAt(n);return e}decode(t){let e=new Uint8Array(t.buffer,t.byteOffset,t.byteLength),n=Array(e.length);for(let t=0,r=e.length;t<r;t++)n[t]=String.fromCharCode(e[t]);return n.join("")}}let n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r=["","=","=="],i=new Uint8Array(256);for(let t=0;t<64;t++)i[n.charCodeAt(t)]=t;class s{encode(t){if("function"==typeof atob)return(new e).encode(atob(t));let n,r,s=3*(t=t.replace(/[^A-Za-z0-9\+\/]/g,"")).length+1>>>2,a=new Uint8Array(s),o=0,h=0;for(let e=0,f=t.length;e<f;e++)if(r=3&e,o|=i[t.charCodeAt(e)]<<6*(3-r),3==r||t.length-e==1){for(n=0;n<3&&h<s;n++,h++)a[h]=o>>>(16>>>n&24)&255;o=0}return a}decode(t){let i=new Uint8Array(t.buffer,t.byteOffset,t.byteLength);if("function"==typeof btoa)return btoa((new e).decode(i));let s=[],a=2,o=0;for(let t=0,e=i.length;t<e;t++)a=t%3,o|=i[t]<<(16>>>a&24),2!=a&&i.length-t!=1||(s.push(n.charAt(o>>>18&63)+n.charAt(o>>>12&63)+n.charAt(o>>>6&63)+n.charAt(63&o)),o=0);return s=s.join(""),s.slice(0,s.length-2+a)+r[2-a]}}class a{encode(t){if("function"==typeof TextEncoder)return(new TextEncoder).encode(t);let e,n=new Uint8Array(4*t.length),r=0;for(let i=0,s=t.length;i<s;i++)e=t.codePointAt(i),e>4096&&i++,e<=127?n[r++]=e:e<=2047?(n[r++]=192|e>>>6&31,n[r++]=128|63&e):e<=65535?(n[r++]=224|e>>>12&15,n[r++]=128|e>>>6&63,n[r++]=128|63&e):(n[r++]=240|e>>>18&7,n[r++]=128|e>>>12&63,n[r++]=128|e>>>6&63,n[r++]=128|63&e)}decode(t){let e=new Uint8Array(t.buffer,t.byteOffset,t.byteLength);if("function"==typeof TextDecoder)return(new TextDecoder).decode(e);let n,r=[];for(let t=0,i=e.length;t<i;)e[t]<128?r.push(String.fromCharCode(e[t++])):e[t]>=192&&e[t]<224?r.push(String.fromCharCode((31&e[t++])<<6|63&e[t++])):e[t]>=224&&e[t]<240?r.push(String.fromCharCode((15&e[t++])<<12|(63&e[t++])<<6|63&e[t++])):e[t]>=240&&e[t]<247?(n=(7&e[t++])<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++],r.push(String.fromCodePoint(n))):t++;return r.join("")}}let o=Array(256),h={};for(let t=0;t<256;t++)o[t]=("00"+t.toString(16)).slice(-2),h[o[t]]=t;class f{encode(t){t=t.replace(/[^A-Fa-f0-9\+\/]/g,"").toLowerCase();let e=new Uint8Array(t.length>>1);for(let n=0;n<t.length;n+=2)e[n>>1]=h[t.slice(n,n+2)];return e}decode(t){let e=new Uint8Array(t.buffer,t.byteOffset,t.byteLength),n=Array(e.length);for(let t=0;t<e.length;t++)n[t]=o[e[t]];return n.join("")}}const c=new Uint8Array([0,1,30,28,27,4,12,6,23,20,3,10,11,25,7,9,13,15,21,8,18,2,29,24,14]),l=new Uint32Array([1,32898,32906,2147516416,32907,2147483649,2147516545,32777,138,136,2147516425,2147483658,2147516555,139,32905,32771,32770,128,32778,2147483658,2147516545,32896,2147483649,2147516424]),u=new Uint8Array(25),d=new Uint8Array(25),y=new Uint8Array(25),w=new Uint8Array(25),p=new Uint8Array(25);let g,b;for(let t=0;t<25;t++)g=t%5,b=Math.floor(t/5),u[t]=(g+1)%5,d[t]=(g+4)%5,y[t]=5*b+(2*g+3*b)%5,w[t]=(g+1)%5*5+b,p[t]=(g+2)%5*5+b;class A{constructor(){this.state=new Uint32Array(25),this.tempState=new Uint32Array(25),this.theta=new Uint32Array(5),this.padBlock=new Uint32Array(16),this.reset()}reset(){this.state.fill(0),this.tempState.fill(0),this.theta.fill(0),this.data=new Uint32Array(0),this.pointer=0,this.padBlock.fill(0),this.padSigBytes=0}keccakF(t){let e,n,r=this.tempState,i=this.theta;for(let s=0;s<22;s++){i[0]=t[0]^t[1]^t[2]^t[3]^t[4],i[1]=t[5]^t[6]^t[7]^t[8]^t[9],i[2]=t[10]^t[11]^t[12]^t[13]^t[14],i[3]=t[15]^t[16]^t[17]^t[18]^t[19],i[4]=t[20]^t[21]^t[22]^t[23]^t[24];for(let s=0;s<25;s++)n=i[u[s]],t[s]^=i[d[s]]^(n<<1|n>>>31),e=c[s],n=t[s],r[y[s]]=n<<e|n>>>32-e;for(let e=0;e<25;e++)t[e]=r[e]^~r[w[e]]&r[p[e]];t[0]^=l[s]}}process(t=!1){let e=(this.data.length-this.pointer)/16;for(let t=0;t<e;t++){for(let t=0;t<16;t++)this.state[t]^=this.data[this.pointer+t];this.keccakF(this.state),this.pointer+=16}if(t){for(let t=0;t<16;t++)this.state[t]^=this.padBlock[t];this.keccakF(this.state)}}append(t){if((t="string"==typeof t?(new a).encode(t):t).byteLength<1)return;let e=this.padBlock,n=this.padSigBytes;if(t.byteLength+n<64)e=new Uint8Array(e.buffer),e.set(new Uint8Array(t.buffer,t.byteOffset,t.byteLength),n),e[e.length-1]=128,e[t.byteLength+n]^=6,this.padBlock=new Uint32Array(e.buffer),this.padSigBytes+=t.byteLength;else{let r=n+t.byteLength>>6<<6,i=(n+t.byteLength)%64;this.data=this.data.byteLength>r?new Uint8Array(this.data.buffer,0,r):new Uint8Array(r),this.data.set(new Uint8Array(e.buffer,0,n)),this.data.set(new Uint8Array(t.buffer,t.byteOffset,t.byteLength-i),n),this.data=new Uint32Array(this.data.buffer,0,r>>2),e.fill(0),this.padSigBytes=0,this.append(new Uint8Array(t.buffer,t.byteOffset+t.byteLength-i,i))}}update(t){return this.append(t),this.process(!1),this}finalize(t=32){this.process(!0);let e=16*Math.ceil(t/64),n=new Uint32Array(e);for(let t=0;t<e;t+=16)n.set(new Uint32Array(this.state.buffer,0,16),t),this.keccakF(this.state);this.data=new Uint32Array(0),this.pointer=0,this.padBlock.fill(0),this.padSigBytes=0;let r=new Uint8Array(n.buffer,0,t);return r.toString=function(t=new f){return t.decode(this)},r}}A.blockBytes=64;class U{constructor(t=32,e=1e3){this.outputBytes=t,this.iterations=e}compute(t,e=new Uint32Array(0)){let n,r=new Uint8Array(this.outputBytes),i=new A,s=new Uint32Array(1);for(let a=0,o=r.length;a<o;a+=64){i.reset(),i.update(e).update(s).finalize();for(let e=0;e<this.iterations;e++){n=i.update(t).finalize(64);for(let t=0,e=r.length;t<64&&a+t<e;t++)r[a+t]^=n[t]}s[0]++}return r}}let m="object"==typeof crypto?function(t){return crypto.getRandomValues(t)}:"object"==typeof module&&"function"==typeof require?function(){const t=require("crypto");return function(e){return t.randomFillSync(e)}}():void 0;const L=16300,B="function"==typeof m,S=new Uint32Array(L);let M=0;function C(){if(M=0,B)m(S);else for(let t=0,e=L;t<e;t++)S[t]=Math.floor(4294967296*Math.random())}class E{word(){return M>=L&&C(),S[M++]}fill(t){if(B&&t.byteLength<=L)return m(t);M>0&&C();let e=new Uint32Array(t.buffer,t.byteOffset,t.byteLength>>2);for(let t=0,n=e.length;t<n;t+=L)e.set(new Uint32Array(S.buffer,0,Math.min(n-t,L)),t),C();let n=t.byteLength>>2<<2,r=new Uint8Array(t.buffer,n,t.byteLength-n),i=this.word();for(let t=0,e=r.length;t<e;t++)r[t]=i>>>8*t&255;return t}bytes(t){return this.fill(new Uint8Array(t))}}E.capacity=L,E.secure=B,C(),B||console.warn("Couldn't find a secure source of randomness. Make sure you are using a modern browser or node v6+");const k=BigInt,R=k(1),O=k(0);function P(t){let e=0,n=k(4294967296),r=!0;for(;t;)r=r&&t>n,e+=r?32:1,t>>=k(r?32:1);return e}function j(t,e,n){let r=R;for(;e;)(e&R)==R&&(r=r*t%n),e>>=R,t=t*t%n;return r}function x(t){let e=O,n=new E;for(let r=0;32*r<t;r++)e=e<<k(32)|k(n.word());return e&(R<<k(t))-R}let z=[k(2)];t:for(let t=3;t<1024;t+=2){for(let e=1;e<z.length;e++)if(k(t)%z[e]===O)continue t;z.push(k(t))}function Q(t,e=6){for(let e=0,n=z.length;e<n;e++)if(t%z[e]==O)return t==z[e];return function(t,e=6){let n,r,i=O,s=t-R,a=Math.min(16,P(t)-1);for(;(s&R)==R;)s>>=R,i++;let o=R,h=t-R;t:for(;e--;)if(n=x(a)+k(5),r=j(n,s,t),r!=o&&r!=h){for(let e=O,n=i-R;e<n;e++){if(r=j(r,k(2),t),r==o)return!1;if(r==h)continue t}return!1}return!0}(t,e)&&function(t,e=6){let n,r=Math.min(16,P(t)-1);for(;e--;)if(n=x(r)+k(5),j(n,t-R,t)!=R)return!1;return!0}(t,e)}function I(t,e=6,n=1e5){let r;for(let i=0;i<n;i++)if(r=x(t)|R|R<<k(t-1),Q(r,e))return r;throw`Couldn't find a prime in ${n} attempts`}function v(t){return k("0x"+(new f).decode(new Uint8Array(t.buffer,t.byteOffset||0,t.byteLength||0)))}function K(t){let e=t.toString(16);return(new f).encode((e.length%2==1?"0":"")+e)}const F=v((new s).encode("///////////JD9qiIWjCNMTGYouA3BzRKQJOCIpnzHQCC76mOxObIlFKCHmONATd75UZs806QxswKwpt8l8UN0/hNW1tUcJF5IW1dmJefsb0TELppjftawv/XLb0Brft7jhr+1qJn6WunyQRfEsf5kkoZlHs5Fs9wgB8uKFjvwWY2kg2HFXTmmkWP6j9JM9fg2VdI9yjrZYcYvNWIIVSu57VKQdwlpZtZww1Tkq8mATxdGwIyhghfDKQXkYuNs474553LBgOhgObJ4Oi7Aeij7XFXfBvTFLJ3ivL9pVYFxg5lUl86pVq5RXSJhiY+gUQFXKOWoqqxC2tMxcNBFB6M6hVIavfHLpk7PuFBFjb7wqK6nFXXQYMfbOXD4Wm4eTHq/WujNsJM9cejJTgSiVhnc7j0iYa0u5r8S/6BtmKCGTYdgJzPshqZFIfKxgXeyAMu+EXV3phXWx3CYjAutlG4gjiT6B05asxQ9tb/OD9EI5LgtEgqSEIARpyPBKnh+bXiHGaEL26WyaZwycYavTiPBqUaDS2FQvaJYPpyirUTOjbu8LbBN6O+S6O/BQfvsqmKHxZR05rwF2ZspZPoJDDoiM7oYZRW+ftH2EpcM7i16+4G912IXBIHNAGkSfVsFqpk7TqmI2P3cGG/7fckKbAj030Nck0BjGZ//////////8=")),T=k(2);class Y{constructor(t=384){this.E=x(t)|k(1)<<k(t-1)}send(){return K(j(T,this.E,F))}receive(t){this.secret=j(v(t),this.E,F)}finalize(t=32){if("bigint"!=typeof this.secret)throw new Error("Key exchange cannot finalize without receiving");return new U(t,1).compute(K(this.secret))}}Y.generator=T,Y.group=F;const q=new Uint32Array([1634760805,857760878,2036477234,1797285236]);class D{constructor(t,e=!0,n=new Uint32Array(3),r=0){this.state=new Uint32Array(16),this.xstate=new Uint32Array(16),this.mask=new Uint32Array(16),this.state.set(q),this.state.set(new Uint32Array(t.buffer,t.byteOffset,t.byteLength>>2),4),this.state.set(new Uint32Array(n.buffer,n.byteOffset,n.byteLength>>2),12),this.state[15]=r,this.mask.set(this.state),this.mask[15]=0;for(let t=0;t<10;t++){for(let t=0;t<4;t++)this.QR(this.mask,t,t+4,t+8,t+12);for(let t=0;t<16;t+=4)this.QR(this.mask,t,t+1,t+2,t+3)}this.doMac=!!e,this.reset()}reset(){if(this.xstate.fill(0),this.Pmac=new Uint32Array(4),this.doMac)for(let t=0;t<16;t++)this.Pmac[3&t]^=this.mask[t];this.Cmac=this.Pmac.slice(),this.data=new Uint32Array(0),this.pointer=0,this.sigBytes=0}get counter(){return this.state[15]}set counter(t){this.state[15]=t}QR(t,e,n,r,i){t[e]+=t[n],t[i]^=t[e],t[i]=t[i]<<16|t[i]>>>16,t[r]+=t[i],t[n]^=t[r],t[n]=t[n]<<12|t[n]>>>20,t[e]+=t[n],t[i]^=t[e],t[i]=t[i]<<8|t[i]>>>24,t[r]+=t[i],t[n]^=t[r],t[n]=t[n]<<7|t[n]>>>25}getMac(){if(!this.doMac)return!1;let t=new Uint32Array([this.Pmac[0]+this.Cmac[0],this.Pmac[1]+this.Cmac[1],this.Pmac[2]+this.Cmac[2],this.Pmac[3]+this.Cmac[3]]);for(let e=0;e<5;e++)this.QR(t,0,1,2,3),this.QR(t,3,0,1,2),this.QR(t,2,3,0,1),this.QR(t,1,2,3,0);for(let e=0;e<4;e++)t[e]^=this.Pmac[e]^this.Cmac[e];return new Uint8Array(t.buffer)}process(t=!1){let e,n,r=(t?Math.ceil:Math.floor)((this.sigBytes-this.pointer)/16),i=Math.ceil(this.sigBytes/4)-1,s=4-this.sigBytes%4,a=this.xstate;for(let t=0;t<r;t++){a.set(this.state);for(let t=0;t<20;t+=2)this.QR(a,0,4,8,12),this.QR(a,1,5,9,13),this.QR(a,2,6,10,14),this.QR(a,3,7,11,15),this.QR(a,0,5,10,15),this.QR(a,1,6,11,12),this.QR(a,2,7,8,13),this.QR(a,3,4,9,14);for(let t=0;t<16&&this.pointer+t<=i;t++)e=this.data[this.pointer+t],n=e^a[t]+this.mask[t],this.pointer+t==i&&(n=n<<8*s>>>8*s),this.data[this.pointer+t]=n,this.doMac&&(this.Pmac[3&t]^=e,this.Cmac[3&t]^=n,this.QR(this.Pmac,t+3&3,3&t,t+1&3,t+2&3),this.QR(this.Cmac,t+3&3,3&t,t+1&3,t+2&3));this.pointer+=16,this.state[15]++}}append(t){t="string"==typeof t?(new a).encode(t):t;let e=this.data;this.data=new Uint8Array(64*Math.ceil((this.sigBytes+t.byteLength)/64)),this.data.set(new Uint8Array(e.buffer,0,this.sigBytes)),this.data.set(new Uint8Array(t.buffer,t.byteOffset,t.byteLength),this.sigBytes),this.data=new Uint32Array(this.data.buffer),this.sigBytes+=t.byteLength}verify(t){if(this.doMac)return this.getMac().join(",")===new Uint8Array(t.buffer,t.byteOffset,t.byteLength).join(",")}update(t){return this.append(t),this.process(!1),this}finalize(){this.process(!0);let t=new Uint8Array(this.data.buffer,0,this.sigBytes);return this.data=new Uint32Array(0),this.pointer=0,this.sigBytes=0,t}}class N{constructor(t,e=new Uint8Array(0)){let n=(new A).update(t).update(e).finalize(64);this.outerKey=n.slice();for(let t=0,e=n.length;t<e;t++)n[t]^=54,this.outerKey[t]^=92;this.hasher=(new A).update(n)}update(t){return this.hasher.update(t),this}finalize(t){return(new A).update(this.outerKey).update(this.hasher.finalize(64)).finalize(t)}}function V(...t){let e=0;for(let n=0;n<t.length;n++)e+=t[n].byteLength;let n=new Uint8Array(e),r=0;for(let e=0;e<t.length;e++)n.set(new Uint8Array(t[e].buffer,t[e].byteOffset,t[e].byteLength),r),r+=t[e].byteLength;return n}const X=32;class J{pad(t,e=128){if(e<=X)throw new Error("OAEP message length too small");let n=new Uint8Array(e-X);n.set(new Uint8Array(t.buffer,t.byteOffset,t.byteLength));let r=new Uint32Array([t.byteLength]),i=(new E).bytes(12),s=V(r,i,(new A).update(n).update(r).update(i).finalize(16)),a=(new A).update(s).finalize(e-X);for(let t=0;t<e-X;t++)n[t]^=a[t];a=(new A).update(n).finalize(X);for(let t=0;t<X;t++)s[t]^=a[t];return V(s,n)}unpad(t){let e=t.byteLength,n=new Uint8Array(t.buffer,0,X).slice(),r=new Uint8Array(t.buffer,X).slice(),i=(new A).update(r).finalize(X);for(let t=0;t<X;t++)n[t]^=i[t];i=(new A).update(n).finalize(e-X);for(let t=0;t<e-X;t++)r[t]^=i[t];let s=new Uint32Array(n.buffer,0,1),a=new Uint8Array(n.buffer,4,12),o=new Uint8Array(n.buffer,16,16);if((new A).update(r).update(s).update(a).finalize(16).join(",")!=o.join(","))throw new Error("OAEP invalid padding hash");return new Uint8Array(r.buffer,0,s[0])}}J.seedLength=12,J.hashLength=16,J.headerLength=X;class G{constructor(t,e){this.E=k(t),this.M=k(e)}static fromBufferViews(t,e){return new this(v(t),v(e))}static fromString(t){let e=t.split("<")[1].split(">")[0].split("|");return this.fromBufferViews((new s).encode(e[0]),(new s).encode(e[1]))}toString(){return"<"+(new s).decode(K(this.E))+"|"+(new s).decode(K(this.M))+">"}process(t){let e=v(t);if(e>=this.M)throw new Error("Data integer too large");return K(j(e,this.E,this.M))}encrypt(t){t="string"==typeof t?(new a).encode(t):t;let e=(P(this.M)>>3)-2-J.headerLength;if(t.byteLength>e)throw new Error("Message too long");return this.process((new J).pad(t,e))}decrypt(t){return(new J).unpad(this.process(t))}sign(t){let e=(new A).update(t).finalize(64);return this.encrypt(e)}verify(t,e){try{t="string"==typeof t?(new a).encode(t):t;let n=(new A).update(t).finalize(64),r=this.decrypt(e);return n.join(",")==r.join(",")}catch(t){return!1}}}const H=k(257),W=["\n==BEGIN ULURU PUBLIC KEY==\n","\n==END ULURU PUBLIC KEY==\n"],Z=["\n==BEGIN ULURU PRIVATE KEY==\n","\n==END ULURU PRIVATE KEY==\n"];class _{constructor(t,e){this.public=t,this.private=e}static fromString(t){return new this(G.fromString(t.split(W[0])[1].split(W[1])[0]),G.fromString(t.split(Z[0])[1].split(Z[1])[0]))}static generate(t=3072){if(!t)return;let e,n,r=k((t>>=1)-8),i=H;do{e=I(t)}while(e%i==k(1));do{n=I(t)}while(n%i==k(1)||n>>r==e>>r);let s=e*n,a=function(t,e){let n,r,i=e,s=O,a=R;for(;t>1;)n=t/e,r=e,e=t%e,t=r,r=s,s=a-n*s,a=r;return a<0?a+i:a}(i,(e-k(1))*(n-k(1)));return new this(new G(i,s),new G(a,s))}toString(){return W[0]+this.public.toString()+W[1]+"\n!\n"+Z[0]+this.private.toString()+Z[1]}}_.publicExponent=H,_.publicPrefix=W,_.privatePrefix=Z;t.Ascii=e,t.Base64=s,t.ChaCha20=D,t.DiffieHellman=Y,t.HMAC=N,t.Hex=f,t.KDF=U,t.Keccak800=A,t.OAEP=J,t.RSAKey=G,t.RSAKeyPair=_,t.Random=E,t.Utf8=a,t.decrypt=function(t,e){let n,r,i;try{n=(new f).encode(t.slice(0,16)),r=(new s).encode(t.slice(16,-32)),i=(new f).encode(t.slice(-32))}catch(t){throw"Incorrectly formated ciphertext"}let o=new U(32,1e3).compute((new a).encode(e),n),h=new D(o,!0,n);h.update(r);let c=h.finalize();if(!h.verify(i))throw"Invalid authentication";return(new a).decode(c)},t.encrypt=function(t,e){let n=(new E).bytes(8),r=new U(32,1e3).compute((new a).encode(e),n),i=new D(r,!0,n);i.update((new a).encode(t));let o=i.finalize(),h=i.getMac();return(new f).decode(n)+(new s).decode(o)+(new f).decode(h)},t.hash=function(t){return(new f).decode((new A).update((new a).encode(t)).finalize())},t.hmac=function(t,e){return(new f).decode(new N((new U).compute(e)).update(t).finalize(16))},t.rsaDecrypt=function(t,e){let n,r,i,o,h;try{n=G.fromString(e),h=t.split("|"),r=(new s).encode(h[0]),i=(new s).encode(h[1].slice(0,-32)),o=(new f).encode(h[1].slice(-32))}catch(t){throw"Incorrectly formatted RSA ciphertext"}r=n.decrypt(r);let c=new D(r,!0),l=c.update(i).finalize();if(!c.verify(o))throw"Invalid RSA message authentication code";return(new a).decode(l)},t.rsaEncrypt=function(t,e){let n=G.fromString(e),r=(new E).bytes(32),i=(new s).decode(n.encrypt(r)),o=new D(r,!0);o.update((new a).encode(t));let h=o.finalize(),c=o.getMac();return i+"|"+(new s).decode(h)+(new f).decode(c)},t.rsaGenerate=function(){return _.generate(3072).toString()},t.rsaSign=function(t,e){return(new s).decode(G.fromString(e).sign((new a).encode(t)))},t.rsaVerify=function(t,e,n){return G.fromString(n).verify((new a).encode(t),(new s).encode(e))},Object.defineProperty(t,"__esModule",{value:!0})}));